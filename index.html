<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Dareloop Gruppen</title>

  <!-- CSS-Styling für die Benutzeroberfläche -->
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f8fafc;
      padding: 20px;
      color: #1f2937;
    }

    input[type="text"] {
      padding: 8px;
      border: 1px solid #d1d5db;
      border-radius: 6px;
      margin-right: 8px;
      width: 250px;
    }

    button {
      padding: 8px 12px;
      background: #10b981;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-weight: bold;
    }

    button:hover {
      background: #059669;
    }

    .group {
      background: white;
      border: 1px solid #e5e7eb;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 20px;
      box-shadow: 0 1px 4px rgba(0, 0, 0, 0.05);
    }

    .group > div strong {
      font-size: 1.1em;
    }

    .challenge-form {
      margin-top: 10px;
    }

    ul.challenges {
      list-style: none;
      padding-left: 0;
      margin-top: 12px;
    }

    ul.challenges li {
      padding: 8px 10px;
      background: #f3f4f6;
      border-radius: 6px;
      margin-bottom: 6px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: grab;
    }

    ul.challenges li:active {
      cursor: grabbing;
      background: #e5e7eb;
    }

    ul.challenges button {
      margin-left: 6px;
      padding: 5px 8px;
      font-size: 0.9em;
    }

    #exportBtn, #importBtn {
      background: #3b82f6;
      margin-left: 6px;
    }

    #exportBtn:hover, #importBtn:hover {
      background: #2563eb;
    }
  </style>
</head>
<body>

  <!-- Eingabefeld für Gruppenname und Buttons für Aktionen -->
  <input type="text" id="groupName" placeholder="Neue Gruppe erstellen" />
  <button id="createGroupBtn">Gruppe erstellen</button>
  <button id="exportBtn">Exportieren</button>
  <input type="file" id="importFile" accept=".json" style="display:none;" />
  <button id="importBtn">Importieren</button>

  <!-- Liste der Gruppen -->
  <ul id="groupList"></ul>

  <script>
    const groupList = document.getElementById('groupList');
    const createGroupBtn = document.getElementById('createGroupBtn');
    const groupNameInput = document.getElementById('groupName');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');

    let groups = JSON.parse(localStorage.getItem('dareloopGroups')) || [];

    function saveGroups() {
      localStorage.setItem('dareloopGroups', JSON.stringify(groups));
    }

    function renderGroups() {
      groupList.innerHTML = '';
      groups.forEach((group, groupIndex) => {
        const li = document.createElement('li');
        li.className = 'group';

        const groupHeader = document.createElement('div');
        groupHeader.innerHTML = `<strong>Gruppe: ${group.name}</strong>`;
        const deleteGroupBtn = document.createElement('button');
        deleteGroupBtn.textContent = 'Gruppe löschen';
        deleteGroupBtn.style.cssText = 'margin-left:10px; background:#ef4444; color:white; border:none; border-radius:4px; cursor:pointer;';
        deleteGroupBtn.addEventListener('click', () => deleteGroup(groupIndex));
        groupHeader.appendChild(deleteGroupBtn);

        const challengeForm = document.createElement('div');
        challengeForm.className = 'challenge-form';

        const challengeInput = document.createElement('input');
        challengeInput.type = 'text';
        challengeInput.placeholder = 'Challenge hinzufügen';

        const addBtn = document.createElement('button');
        addBtn.textContent = '+';
        addBtn.addEventListener('click', () => {
          const challenge = challengeInput.value.trim();
          if (challenge !== '') {
            groups[groupIndex].challenges.push(challenge);
            saveGroups();
            renderGroups();
          }
        });

        challengeForm.appendChild(challengeInput);
        challengeForm.appendChild(addBtn);

        const challengeList = document.createElement('ul');
        challengeList.className = 'challenges';
        challengeList.setAttribute('data-group-index', groupIndex);
        challengeList.addEventListener('dragover', e => e.preventDefault());
        challengeList.addEventListener('drop', handleDrop);

        group.challenges.forEach((challenge, challengeIndex) => {
          const item = document.createElement('li');
          item.textContent = challenge;
          item.setAttribute('draggable', 'true');
          item.setAttribute('data-challenge-index', challengeIndex);
          item.addEventListener('dragstart', handleDragStart);

          const editBtn = document.createElement('button');
          editBtn.textContent = '✎';
          editBtn.style.cssText = 'margin-left:10px; background:#3b82f6; color:white; border:none; border-radius:4px; cursor:pointer;';
          editBtn.addEventListener('click', () => editChallenge(groupIndex, challengeIndex));

          const deleteBtn = document.createElement('button');
          deleteBtn.textContent = 'X';
          deleteBtn.style.cssText = 'margin-left:5px; background:#ef4444; color:white; border:none; border-radius:4px; cursor:pointer;';
          deleteBtn.addEventListener('click', () => {
            groups[groupIndex].challenges.splice(challengeIndex, 1);
            saveGroups();
            renderGroups();
          });

          item.appendChild(editBtn);
          item.appendChild(deleteBtn);
          challengeList.appendChild(item);
        });

        li.appendChild(groupHeader);
        li.appendChild(challengeForm);
        li.appendChild(challengeList);

        groupList.appendChild(li);
      });
    }

    function createGroup() {
      const name = groupNameInput.value.trim();
      if (name === '') return;
      groups.push({ name, challenges: [] });
      saveGroups();
      renderGroups();
      groupNameInput.value = '';
    }

    function deleteGroup(index) {
      if (confirm('Diese Gruppe wirklich löschen?')) {
        groups.splice(index, 1);
        saveGroups();
        renderGroups();
      }
    }

    function editChallenge(groupIndex, challengeIndex) {
      const newText = prompt('Challenge bearbeiten:', groups[groupIndex].challenges[challengeIndex]);
      if (newText !== null) {
        groups[groupIndex].challenges[challengeIndex] = newText.trim();
        saveGroups();
        renderGroups();
      }
    }

    function handleDragStart(e) {
      e.dataTransfer.setData('text/plain', e.target.getAttribute('data-challenge-index'));
      e.dataTransfer.setData('group-index', e.target.parentElement.getAttribute('data-group-index'));
    }

    function handleDrop(e) {
      const draggedIndex = +e.dataTransfer.getData('text/plain');
      const groupIndex = +e.dataTransfer.getData('group-index');
      const targetGroupIndex = +e.currentTarget.getAttribute('data-group-index');

      if (groupIndex !== targetGroupIndex) return;

      const challengeList = groups[groupIndex].challenges;
      const movedItem = challengeList.splice(draggedIndex, 1)[0];

      const dropPosition = [...e.currentTarget.children].indexOf(e.target.closest('li'));
      challengeList.splice(dropPosition === -1 ? challengeList.length : dropPosition, 0, movedItem);

      saveGroups();
      renderGroups();
    }

    exportBtn.addEventListener('click', () => {
      const dataStr = JSON.stringify(groups, null, 2);
      const blob = new Blob([dataStr], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'dareloopGroups.json';
      a.click();
      URL.revokeObjectURL(url);
    });

    importBtn.addEventListener('click', () => importFile.click());

    importFile.addEventListener('change', () => {
      const file = importFile.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = e => {
        try {
          const data = JSON.parse(e.target.result);
          if (Array.isArray(data)) {
            groups = data;
            saveGroups();
            renderGroups();
          } else {
            alert('Ungültige JSON-Struktur.');
          }
        } catch {
          alert('Fehler beim Parsen der Datei.');
       
